{% extends "layout.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="glass-card">
    <div class="dashboard-header">
        <h1><i class="fas fa-tachometer-alt"></i> Dashboard</h1>
        <p>Kelola produk dan pantau tanggal kadaluarsa</p>
    </div>

    {% if near_expiry_products %}
    <div class="alert-card warning">
        <div class="alert-icon">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="alert-content">
            <h3>Produk Mendekati Kadaluarsa!</h3>
            <ul>
                {% for p in near_expiry_products %}
                <li>{{ p[1] }} (kadaluarsa: {{ p[3] }})</li>
                {% endfor %}
            </ul>
        </div>
    </div>
    {% endif %}
</div>

<div class="glass-card">
    <h2><i class="fas fa-plus-circle"></i> Tambah Produk Baru</h2>
    <form action="{{ url_for('add_product') }}" method="POST" enctype="multipart/form-data">
        <div class="form-group">
            <label class="form-label">Nama Produk</label>
            <input type="text" name="product_name" class="form-control" placeholder="Masukkan nama produk" required>
        </div>
        <div class="form-group">
            <label class="form-label">Deskripsi</label>
            <textarea name="description" class="form-control" rows="3" placeholder="Masukkan deskripsi produk"></textarea>
        </div>
        <div class="form-group">
            <label class="form-label">Tanggal Kadaluarsa</label>
            <input type="date" name="expiry_date" class="form-control" required>
        </div>
        <div class="form-group">
            <label class="form-label">Gambar Produk</label>
            <div class="file-upload">
                <label class="upload-label">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <span>Pilih Gambar</span>
                    <input type="file" name="image" accept="image/*" required hidden>
                </label>
                <span class="file-name">Belum ada file dipilih</span>
            </div>
        </div>
        <button type="submit" class="btn btn-primary">
            <i class="fas fa-save"></i> Tambah Produk
        </button>
    </form>
</div>

<div class="glass-card">
    <div class="section-header">
        <h2><i class="fas fa-box-open"></i> Daftar Produk Anda</h2>
        <div class="product-count">{{ products|length }} produk</div>
    </div>

    {% if products %}
    <div class="product-grid">
        {% for p in products %}
        <div class="product-card">
            {% if p[3] and p[3] < today %}
            <div class="product-badge badge-expired">Kadaluarsa</div>
            {% elif p[3] and (p[3] - today).days <= 7 %}
            <div class="product-badge badge-warning">Segera Kadaluarsa</div>
            {% else %}
            <div class="product-badge badge-safe">Aman</div>
            {% endif %}
            
            <img src="{{ url_for('uploaded_file', filename=p[4]) }}" alt="{{ p[1] }}" class="product-image">
            
            <div class="product-content">
                <h3 class="product-title">{{ p[1] }}</h3>
                <p class="product-desc">{{ p[2] }}</p>
                
                <div class="product-expiry">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Kadaluarsa: {{ p[3] }}</span>
                </div>
                
                <div class="product-actions">
                    <form action="{{ url_for('delete_product', product_id=p[0]) }}" method="POST">
                        <button type="submit" class="btn btn-danger" onclick="return confirm('Yakin ingin menghapus produk ini?')">
                            <i class="fas fa-trash"></i> Hapus
                        </button>
                    </form>
                    <form action="{{ url_for('edit_product', product_id=p[0]) }}" method="GET">
                        <button type="submit" class="btn btn-secondary">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <i class="fas fa-box-open fa-4x"></i>
        <h3>Belum Ada Produk</h3>
        <p>Anda belum menambahkan produk apapun. Tambahkan produk pertama Anda di atas.</p>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block css %}
<style>
.dashboard-header {
    margin-bottom: 1.5rem;
}

.dashboard-header h1 {
    font-size: 2rem;
    color: var(--dark);
    display: flex;
    align-items: center;
    gap: 1rem;
}

.dashboard-header p {
    color: #666;
}

.alert-card {
    display: flex;
    gap: 1rem;
    padding: 1.5rem;
    border-radius: 10px;
    margin-bottom: 2rem;
}

.alert-card.warning {
    background: rgba(255, 214, 102, 0.2);
    border-left: 4px solid var(--accent);
}

.alert-icon {
    font-size: 1.5rem;
    color: var(--accent);
}

.alert-content h3 {
    margin-bottom: 0.5rem;
    color: var(--dark);
}

.alert-content ul {
    padding-left: 1.5rem;
}

.alert-content li {
    margin-bottom: 0.3rem;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.section-header h2 {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 1.5rem;
}

.product-count {
    background: var(--primary);
    color: white;
    padding: 0.3rem 0.8rem;
    border-radius: 50px;
    font-size: 0.9rem;
    font-weight: 500;
}

.empty-state {
    text-align: center;
    padding: 3rem 0;
    color: #666;
}

.empty-state i {
    margin-bottom: 1rem;
    color: var(--gray);
}

.empty-state h3 {
    margin-bottom: 0.5rem;
    color: var(--dark);
}

.file-upload {
    margin-top: 0.5rem;
}

.upload-label {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.8rem 1.2rem;
    background: var(--primary);
    color: white;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.upload-label:hover {
    background: var(--primary-dark);
}

.file-name {
    display: block;
    margin-top: 0.5rem;
    font-size: 0.9rem;
    color: #666;
}
</style>
{% endblock %}

{% block js %}
<script>
// Update file name display
document.querySelector('input[type="file"]').addEventListener('change', function(e) {
    const fileName = e.target.files[0] ? e.target.files[0].name : 'Belum ada file dipilih';
    document.querySelector('.file-name').textContent = fileName;
});

// Close flash messages
document.querySelectorAll('.close-flash').forEach(btn => {
    btn.addEventListener('click', (e) => {
        e.target.parentElement.style.animation = 'slideIn 0.5s reverse forwards';
        setTimeout(() => {
            e.target.parentElement.remove();
        }, 500);
    });
});

// Auto-close flash messages after 5 seconds
setTimeout(() => {
    document.querySelectorAll('.flash-message').forEach(msg => {
        msg.style.animation = 'slideIn 0.5s reverse forwards';
        setTimeout(() => {
            msg.remove();
        }, 500);
    });
}, 5000);
</script>
{% endblock %}